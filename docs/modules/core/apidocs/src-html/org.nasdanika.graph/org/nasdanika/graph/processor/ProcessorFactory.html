<!doctype html>
<html lang="en">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">

<script src="../../../../../../../../../search-documents.js"></script>

<script src="https://unpkg.com/lunr/lunr.js"></script>

<script>
// Script for full-text search of JsTree

window.nsdJsTreeSearchCallback = function(str, node) { 
    var sf = new $.vakata.search(str, true, { caseSensitive : false, fuzzy : false }); 
    if (sf.search(node.text).isMatch) {
		return true;
	} 
    let searchResult = this.search(str); 
    for (const sr in searchResult) {
        if (searchResult[sr].ref === node.original['data-nsd-action-uuid']) {
            return true;
        } 
    } 
    return false; 
}.bind(lunr(function () {
			  this.ref('id');
			  this.field('title');
			  this.field('content');

			  for (const key in searchDocuments) {
				  let doc = searchDocuments[key];
				this.add({
					id: doc['action-uuid'],
					title: doc.title,
					path: doc.path,
					content: doc.content
				});  
			  }
			}));
</script>
</head>
<body>
<main role="main">
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span><a id="line.1">package org.nasdanika.graph.processor;</a>
<span class="sourceLineNo">002</span><a id="line.2"></a>
<span class="sourceLineNo">003</span><a id="line.3">import java.util.Arrays;</a>
<span class="sourceLineNo">004</span><a id="line.4">import java.util.Collection;</a>
<span class="sourceLineNo">005</span><a id="line.5">import java.util.Collections;</a>
<span class="sourceLineNo">006</span><a id="line.6">import java.util.List;</a>
<span class="sourceLineNo">007</span><a id="line.7">import java.util.Map;</a>
<span class="sourceLineNo">008</span><a id="line.8">import java.util.Optional;</a>
<span class="sourceLineNo">009</span><a id="line.9">import java.util.function.Consumer;</a>
<span class="sourceLineNo">010</span><a id="line.10">import java.util.function.Supplier;</a>
<span class="sourceLineNo">011</span><a id="line.11">import java.util.stream.Collectors;</a>
<span class="sourceLineNo">012</span><a id="line.12">import java.util.stream.Stream;</a>
<span class="sourceLineNo">013</span><a id="line.13"></a>
<span class="sourceLineNo">014</span><a id="line.14">import org.nasdanika.common.Composeable;</a>
<span class="sourceLineNo">015</span><a id="line.15">import org.nasdanika.graph.Connection;</a>
<span class="sourceLineNo">016</span><a id="line.16">import org.nasdanika.graph.Element;</a>
<span class="sourceLineNo">017</span><a id="line.17"></a>
<span class="sourceLineNo">018</span><a id="line.18">/**</a>
<span class="sourceLineNo">019</span><a id="line.19"> * Processor factory creates and "wires" processors.</a>
<span class="sourceLineNo">020</span><a id="line.20"> * @author Pavel</a>
<span class="sourceLineNo">021</span><a id="line.21"> *</a>
<span class="sourceLineNo">022</span><a id="line.22"> * @param &lt;P&gt; Processor type - what is passed to parent/child processors and also returned to the client code to interact with the processor network. For model elements which are not interacted with by other processors or the client code the result may be null.</a>
<span class="sourceLineNo">023</span><a id="line.23"> * @param &lt;H&gt; Handler type. Handlers are invoked by endpoints. </a>
<span class="sourceLineNo">024</span><a id="line.24"> * @param &lt;E&gt; Endpoint type. Endpoints pass invocations to handlers.</a>
<span class="sourceLineNo">025</span><a id="line.25"> */</a>
<span class="sourceLineNo">026</span><a id="line.26">public interface ProcessorFactory&lt;P,H,E&gt; extends Composeable&lt;ProcessorFactory&lt;P,H,E&gt;&gt; {</a>
<span class="sourceLineNo">027</span><a id="line.27">        </a>
<span class="sourceLineNo">028</span><a id="line.28">        /**</a>
<span class="sourceLineNo">029</span><a id="line.29">         * If a connection is pass-through its source endpoint is connected directly to the target node handler and vice versa.</a>
<span class="sourceLineNo">030</span><a id="line.30">         * @param connection</a>
<span class="sourceLineNo">031</span><a id="line.31">         * @return</a>
<span class="sourceLineNo">032</span><a id="line.32">         */</a>
<span class="sourceLineNo">033</span><a id="line.33">        default boolean isPassThrough(Connection connection) {</a>
<span class="sourceLineNo">034</span><a id="line.34">                return true;</a>
<span class="sourceLineNo">035</span><a id="line.35">        };</a>
<span class="sourceLineNo">036</span><a id="line.36">        </a>
<span class="sourceLineNo">037</span><a id="line.37">        /**</a>
<span class="sourceLineNo">038</span><a id="line.38">         * Creates an endpoint to invoke the argument handler of specified type.</a>
<span class="sourceLineNo">039</span><a id="line.39">         * @param connection</a>
<span class="sourceLineNo">040</span><a id="line.40">         * @param handler</a>
<span class="sourceLineNo">041</span><a id="line.41">         * @param type</a>
<span class="sourceLineNo">042</span><a id="line.42">         * @return</a>
<span class="sourceLineNo">043</span><a id="line.43">         */</a>
<span class="sourceLineNo">044</span><a id="line.44">        E createEndpoint(Connection connection, H handler, HandlerType type);</a>
<span class="sourceLineNo">045</span><a id="line.45">        </a>
<span class="sourceLineNo">046</span><a id="line.46">        /**</a>
<span class="sourceLineNo">047</span><a id="line.47">         * Creates a processor and returns processor info. This implementation returns info with &lt;code&gt;null&lt;/code&gt; processor.</a>
<span class="sourceLineNo">048</span><a id="line.48">         * @param config</a>
<span class="sourceLineNo">049</span><a id="line.49">         * @param parentProcessorInfoCallbackConsumer</a>
<span class="sourceLineNo">050</span><a id="line.50">         * @param registryCallbackConsumer</a>
<span class="sourceLineNo">051</span><a id="line.51">         * @return</a>
<span class="sourceLineNo">052</span><a id="line.52">         */</a>
<span class="sourceLineNo">053</span><a id="line.53">        default ProcessorInfo&lt;P&gt; createProcessor(</a>
<span class="sourceLineNo">054</span><a id="line.54">                        ProcessorConfig&lt;P&gt; config, </a>
<span class="sourceLineNo">055</span><a id="line.55">                        Consumer&lt;Consumer&lt;ProcessorInfo&lt;P&gt;&gt;&gt; parentProcessorInfoCallbackConsumer,</a>
<span class="sourceLineNo">056</span><a id="line.56">                        Consumer&lt;Consumer&lt;Map&lt;Element, ProcessorInfo&lt;P&gt;&gt;&gt;&gt; registryCallbackConsumer) {</a>
<span class="sourceLineNo">057</span><a id="line.57">                return ProcessorInfo.of(config, null);</a>
<span class="sourceLineNo">058</span><a id="line.58">        }</a>
<span class="sourceLineNo">059</span><a id="line.59">        </a>
<span class="sourceLineNo">060</span><a id="line.60">        default Map&lt;Element,ProcessorInfo&lt;P&gt;&gt; createProcessors(Element... elements) {</a>
<span class="sourceLineNo">061</span><a id="line.61">                return createProcessors(Arrays.stream(elements));</a>
<span class="sourceLineNo">062</span><a id="line.62">        }</a>
<span class="sourceLineNo">063</span><a id="line.63">        </a>
<span class="sourceLineNo">064</span><a id="line.64">        default Map&lt;Element,ProcessorInfo&lt;P&gt;&gt; createProcessors(Collection&lt;Element&gt; elements) {</a>
<span class="sourceLineNo">065</span><a id="line.65">                return createProcessors(elements.stream());</a>
<span class="sourceLineNo">066</span><a id="line.66">        }</a>
<span class="sourceLineNo">067</span><a id="line.67">        </a>
<span class="sourceLineNo">068</span><a id="line.68">        default Map&lt;Element,ProcessorInfo&lt;P&gt;&gt; createProcessors(Stream&lt;Element&gt; elements) {</a>
<span class="sourceLineNo">069</span><a id="line.69">                ProcessorFactoryVisitor&lt;P, H, E&gt; visitor = new ProcessorFactoryVisitor&lt;&gt;(this);                         </a>
<span class="sourceLineNo">070</span><a id="line.70">                List&lt;Helper&lt;P&gt;&gt; helpers = elements.map(element -&gt; element.accept(visitor::createElementProcessor)).collect(Collectors.toList());</a>
<span class="sourceLineNo">071</span><a id="line.71">                Map&lt;Element, ProcessorInfo&lt;P&gt;&gt; registry = visitor.getRegistry();</a>
<span class="sourceLineNo">072</span><a id="line.72">                helpers.forEach(helper -&gt; helper.setRegistry(registry));</a>
<span class="sourceLineNo">073</span><a id="line.73">                return Collections.unmodifiableMap(registry);           </a>
<span class="sourceLineNo">074</span><a id="line.74">        }</a>
<span class="sourceLineNo">075</span><a id="line.75">        </a>
<span class="sourceLineNo">076</span><a id="line.76">        /**</a>
<span class="sourceLineNo">077</span><a id="line.77">         * Handler proxy passes invocations to the handler returned by the supplier. </a>
<span class="sourceLineNo">078</span><a id="line.78">         * This method is used to create endpoints before actual handlers are provided by processors.</a>
<span class="sourceLineNo">079</span><a id="line.79">         * @param connection</a>
<span class="sourceLineNo">080</span><a id="line.80">         * @param handlerSupplier</a>
<span class="sourceLineNo">081</span><a id="line.81">         * @param type</a>
<span class="sourceLineNo">082</span><a id="line.82">         * @return</a>
<span class="sourceLineNo">083</span><a id="line.83">         */</a>
<span class="sourceLineNo">084</span><a id="line.84">        H createHandlerProxy(Connection connection, Supplier&lt;H&gt; handlerSupplier, HandlerType type);</a>
<span class="sourceLineNo">085</span><a id="line.85">        </a>
<span class="sourceLineNo">086</span><a id="line.86">        /**</a>
<span class="sourceLineNo">087</span><a id="line.87">         * Composes this and the other factory</a>
<span class="sourceLineNo">088</span><a id="line.88">         */</a>
<span class="sourceLineNo">089</span><a id="line.89">        @Override</a>
<span class="sourceLineNo">090</span><a id="line.90">        default ProcessorFactory&lt;P, H, E&gt; compose(ProcessorFactory&lt;P, H, E&gt; other) {</a>
<span class="sourceLineNo">091</span><a id="line.91">                if (other == null) {</a>
<span class="sourceLineNo">092</span><a id="line.92">                        return this;</a>
<span class="sourceLineNo">093</span><a id="line.93">                }</a>
<span class="sourceLineNo">094</span><a id="line.94">                </a>
<span class="sourceLineNo">095</span><a id="line.95">                return new ProcessorFactory&lt;P, H, E&gt;() {</a>
<span class="sourceLineNo">096</span><a id="line.96"></a>
<span class="sourceLineNo">097</span><a id="line.97">                        @Override</a>
<span class="sourceLineNo">098</span><a id="line.98">                        public E createEndpoint(Connection connection, H handler, HandlerType type) {</a>
<span class="sourceLineNo">099</span><a id="line.99">                                E endpoint = ProcessorFactory.this.createEndpoint(connection, handler, type);</a>
<span class="sourceLineNo">100</span><a id="line.100">                                if (endpoint != null) {</a>
<span class="sourceLineNo">101</span><a id="line.101">                                        return endpoint;</a>
<span class="sourceLineNo">102</span><a id="line.102">                                }</a>
<span class="sourceLineNo">103</span><a id="line.103">                                return other.createEndpoint(connection, handler, type);</a>
<span class="sourceLineNo">104</span><a id="line.104">                        }</a>
<span class="sourceLineNo">105</span><a id="line.105"></a>
<span class="sourceLineNo">106</span><a id="line.106">                        @Override</a>
<span class="sourceLineNo">107</span><a id="line.107">                        public H createHandlerProxy(Connection connection, Supplier&lt;H&gt; handlerSupplier, HandlerType type) {</a>
<span class="sourceLineNo">108</span><a id="line.108">                                H handler = ProcessorFactory.this.createHandlerProxy(connection, handlerSupplier, type);</a>
<span class="sourceLineNo">109</span><a id="line.109">                                if (handler != null) {</a>
<span class="sourceLineNo">110</span><a id="line.110">                                        return handler;</a>
<span class="sourceLineNo">111</span><a id="line.111">                                }</a>
<span class="sourceLineNo">112</span><a id="line.112">                                return other.createHandlerProxy(connection, handlerSupplier, type);</a>
<span class="sourceLineNo">113</span><a id="line.113">                        }</a>
<span class="sourceLineNo">114</span><a id="line.114">                        </a>
<span class="sourceLineNo">115</span><a id="line.115">                        @Override</a>
<span class="sourceLineNo">116</span><a id="line.116">                        public ProcessorInfo&lt;P&gt; createProcessor(</a>
<span class="sourceLineNo">117</span><a id="line.117">                                        ProcessorConfig&lt;P&gt; config,</a>
<span class="sourceLineNo">118</span><a id="line.118">                                        Consumer&lt;Consumer&lt;ProcessorInfo&lt;P&gt;&gt;&gt; parentProcessorInfoCallbackConsumer,</a>
<span class="sourceLineNo">119</span><a id="line.119">                                        Consumer&lt;Consumer&lt;Map&lt;Element, ProcessorInfo&lt;P&gt;&gt;&gt;&gt; registryCallbackConsumer) {</a>
<span class="sourceLineNo">120</span><a id="line.120">                                </a>
<span class="sourceLineNo">121</span><a id="line.121">                                ProcessorInfo&lt;P&gt; info = ProcessorFactory.this.createProcessor(config, parentProcessorInfoCallbackConsumer, registryCallbackConsumer);</a>
<span class="sourceLineNo">122</span><a id="line.122">                                return info.getProcessor() == null ? other.createProcessor(config, parentProcessorInfoCallbackConsumer, registryCallbackConsumer) : info;</a>
<span class="sourceLineNo">123</span><a id="line.123">                        }</a>
<span class="sourceLineNo">124</span><a id="line.124">                };</a>
<span class="sourceLineNo">125</span><a id="line.125">                </a>
<span class="sourceLineNo">126</span><a id="line.126">        }</a>
<span class="sourceLineNo">127</span><a id="line.127">        </a>
<span class="sourceLineNo">128</span><a id="line.128">        /**</a>
<span class="sourceLineNo">129</span><a id="line.129">         * Composes a stream of factories into a single factory.</a>
<span class="sourceLineNo">130</span><a id="line.130">         * @param &lt;P&gt;</a>
<span class="sourceLineNo">131</span><a id="line.131">         * @param &lt;H&gt;</a>
<span class="sourceLineNo">132</span><a id="line.132">         * @param &lt;E&gt;</a>
<span class="sourceLineNo">133</span><a id="line.133">         * @param factories</a>
<span class="sourceLineNo">134</span><a id="line.134">         * @return</a>
<span class="sourceLineNo">135</span><a id="line.135">         */</a>
<span class="sourceLineNo">136</span><a id="line.136">        static &lt;P, H, E&gt; Optional&lt;ProcessorFactory&lt;P, H, E&gt;&gt; compose(Stream&lt;ProcessorFactory&lt;P, H, E&gt;&gt; factories) {</a>
<span class="sourceLineNo">137</span><a id="line.137">                return factories.reduce(Composeable::composer);</a>
<span class="sourceLineNo">138</span><a id="line.138">        }</a>
<span class="sourceLineNo">139</span><a id="line.139"></a>
<span class="sourceLineNo">140</span><a id="line.140">}</a>




























































</pre>
</div>
</main>
</body>
</html>
