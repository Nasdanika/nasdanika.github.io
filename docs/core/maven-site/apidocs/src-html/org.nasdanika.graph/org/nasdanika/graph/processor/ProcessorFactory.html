<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>Source code</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="source: module: org.nasdanika.graph, package: org.nasdanika.graph.processor, interface: ProcessorFactory">
<meta name="generator" content="javadoc/SourceToHTMLConverter">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
</head>
<body class="source-page">
<main role="main">
<div class="source-container">
<pre><span class="source-line-no">001</span><span id="line-1">package org.nasdanika.graph.processor;</span>
<span class="source-line-no">002</span><span id="line-2"></span>
<span class="source-line-no">003</span><span id="line-3">import java.util.Arrays;</span>
<span class="source-line-no">004</span><span id="line-4">import java.util.Collection;</span>
<span class="source-line-no">005</span><span id="line-5">import java.util.Collections;</span>
<span class="source-line-no">006</span><span id="line-6">import java.util.List;</span>
<span class="source-line-no">007</span><span id="line-7">import java.util.Map;</span>
<span class="source-line-no">008</span><span id="line-8">import java.util.Optional;</span>
<span class="source-line-no">009</span><span id="line-9">import java.util.function.BiFunction;</span>
<span class="source-line-no">010</span><span id="line-10">import java.util.stream.Collectors;</span>
<span class="source-line-no">011</span><span id="line-11">import java.util.stream.Stream;</span>
<span class="source-line-no">012</span><span id="line-12"></span>
<span class="source-line-no">013</span><span id="line-13">import org.nasdanika.common.Composeable;</span>
<span class="source-line-no">014</span><span id="line-14">import org.nasdanika.common.ProgressMonitor;</span>
<span class="source-line-no">015</span><span id="line-15">import org.nasdanika.graph.Connection;</span>
<span class="source-line-no">016</span><span id="line-16">import org.nasdanika.graph.Element;</span>
<span class="source-line-no">017</span><span id="line-17"></span>
<span class="source-line-no">018</span><span id="line-18">/**</span>
<span class="source-line-no">019</span><span id="line-19"> * Processor factory creates and "wires" processors.</span>
<span class="source-line-no">020</span><span id="line-20"> * @author Pavel</span>
<span class="source-line-no">021</span><span id="line-21"> *</span>
<span class="source-line-no">022</span><span id="line-22"> * @param &lt;P&gt; Processor type - what is passed to parent/child processors and also returned to the client code to interact with the processor network. For model elements which are not interacted with by other processors or the client code the result may be null.</span>
<span class="source-line-no">023</span><span id="line-23"> * @param &lt;H&gt; Handler type. Handlers are invoked by endpoints. </span>
<span class="source-line-no">024</span><span id="line-24"> * @param &lt;E&gt; Endpoint type. Endpoints pass invocations to handlers.</span>
<span class="source-line-no">025</span><span id="line-25"> */</span>
<span class="source-line-no">026</span><span id="line-26">public interface ProcessorFactory&lt;P,H,E&gt; extends Composeable&lt;ProcessorFactory&lt;P,H,E&gt;&gt; {</span>
<span class="source-line-no">027</span><span id="line-27">        </span>
<span class="source-line-no">028</span><span id="line-28">        /**</span>
<span class="source-line-no">029</span><span id="line-29">         * If a connection is pass-through its source endpoint is connected directly to the target node handler and vice versa.</span>
<span class="source-line-no">030</span><span id="line-30">         * @param connection</span>
<span class="source-line-no">031</span><span id="line-31">         * @return</span>
<span class="source-line-no">032</span><span id="line-32">         */</span>
<span class="source-line-no">033</span><span id="line-33">        default boolean isPassThrough(Connection connection) {</span>
<span class="source-line-no">034</span><span id="line-34">                return true;</span>
<span class="source-line-no">035</span><span id="line-35">        };</span>
<span class="source-line-no">036</span><span id="line-36">        </span>
<span class="source-line-no">037</span><span id="line-37">        /**</span>
<span class="source-line-no">038</span><span id="line-38">         * Creates an endpoint to invoke the argument handler of specified type.</span>
<span class="source-line-no">039</span><span id="line-39">         * @param connection</span>
<span class="source-line-no">040</span><span id="line-40">         * @param handler</span>
<span class="source-line-no">041</span><span id="line-41">         * @param type</span>
<span class="source-line-no">042</span><span id="line-42">         * @return</span>
<span class="source-line-no">043</span><span id="line-43">         */</span>
<span class="source-line-no">044</span><span id="line-44">        E createEndpoint(Connection connection, H handler, HandlerType type);</span>
<span class="source-line-no">045</span><span id="line-45">        </span>
<span class="source-line-no">046</span><span id="line-46">        /**</span>
<span class="source-line-no">047</span><span id="line-47">         * Creates a processor and returns processor info. This implementation returns info with &lt;code&gt;null&lt;/code&gt; processor.</span>
<span class="source-line-no">048</span><span id="line-48">         * @param config</span>
<span class="source-line-no">049</span><span id="line-49">         * @param parentProcessorInfoCallbackConsumer</span>
<span class="source-line-no">050</span><span id="line-50">         * @param registryCallbackConsumer</span>
<span class="source-line-no">051</span><span id="line-51">         * @return</span>
<span class="source-line-no">052</span><span id="line-52">         */</span>
<span class="source-line-no">053</span><span id="line-53">        default ProcessorInfo&lt;P&gt; createProcessor(ProcessorConfig&lt;P&gt; config, ProgressMonitor progressMonitor) {</span>
<span class="source-line-no">054</span><span id="line-54">                return ProcessorInfo.of(config, null, null);</span>
<span class="source-line-no">055</span><span id="line-55">        }</span>
<span class="source-line-no">056</span><span id="line-56">        </span>
<span class="source-line-no">057</span><span id="line-57">        default Map&lt;Element,ProcessorInfo&lt;P&gt;&gt; createProcessors(ProgressMonitor progressMonitor, Element... elements) {</span>
<span class="source-line-no">058</span><span id="line-58">                return createProcessors(Arrays.stream(elements), progressMonitor);</span>
<span class="source-line-no">059</span><span id="line-59">        }</span>
<span class="source-line-no">060</span><span id="line-60">        </span>
<span class="source-line-no">061</span><span id="line-61">        default Map&lt;Element,ProcessorInfo&lt;P&gt;&gt; createProcessors(Collection&lt;Element&gt; elements, ProgressMonitor progressMonitor) {</span>
<span class="source-line-no">062</span><span id="line-62">                return createProcessors(elements.stream(), progressMonitor);</span>
<span class="source-line-no">063</span><span id="line-63">        }</span>
<span class="source-line-no">064</span><span id="line-64">        </span>
<span class="source-line-no">065</span><span id="line-65">        default Map&lt;Element,ProcessorInfo&lt;P&gt;&gt; createProcessors(Stream&lt;? extends Element&gt; elements, ProgressMonitor progressMonitor) {</span>
<span class="source-line-no">066</span><span id="line-66">                ProcessorFactoryVisitor&lt;P, H, E&gt; visitor = new ProcessorFactoryVisitor&lt;&gt;(this);                         </span>
<span class="source-line-no">067</span><span id="line-67">                BiFunction&lt;Element, Map&lt;? extends Element, Helper&lt;P&gt;&gt;, Helper&lt;P&gt;&gt; createElementProcessor = (element, childProcessors) -&gt; visitor.createElementProcessor(element, childProcessors, progressMonitor);</span>
<span class="source-line-no">068</span><span id="line-68">                List&lt;Helper&lt;P&gt;&gt; helpers = elements.map(element -&gt; element.accept(createElementProcessor)).collect(Collectors.toList());</span>
<span class="source-line-no">069</span><span id="line-69">                Map&lt;Element, ProcessorInfo&lt;P&gt;&gt; registry = visitor.getRegistry();</span>
<span class="source-line-no">070</span><span id="line-70">                Map&lt;Element, ProcessorInfo&lt;P&gt;&gt; unmodifiableRegistry = Collections.unmodifiableMap(registry);</span>
<span class="source-line-no">071</span><span id="line-71">                helpers.forEach(helper -&gt; helper.setRegistry(unmodifiableRegistry));</span>
<span class="source-line-no">072</span><span id="line-72">                return unmodifiableRegistry;            </span>
<span class="source-line-no">073</span><span id="line-73">        }</span>
<span class="source-line-no">074</span><span id="line-74">        </span>
<span class="source-line-no">075</span><span id="line-75">        /**</span>
<span class="source-line-no">076</span><span id="line-76">         * Composes this and the other factory</span>
<span class="source-line-no">077</span><span id="line-77">         */</span>
<span class="source-line-no">078</span><span id="line-78">        @Override</span>
<span class="source-line-no">079</span><span id="line-79">        default ProcessorFactory&lt;P, H, E&gt; compose(ProcessorFactory&lt;P, H, E&gt; other) {</span>
<span class="source-line-no">080</span><span id="line-80">                if (other == null) {</span>
<span class="source-line-no">081</span><span id="line-81">                        return this;</span>
<span class="source-line-no">082</span><span id="line-82">                }</span>
<span class="source-line-no">083</span><span id="line-83">                </span>
<span class="source-line-no">084</span><span id="line-84">                return new ProcessorFactory&lt;P, H, E&gt;() {</span>
<span class="source-line-no">085</span><span id="line-85"></span>
<span class="source-line-no">086</span><span id="line-86">                        @Override</span>
<span class="source-line-no">087</span><span id="line-87">                        public E createEndpoint(Connection connection, H handler, HandlerType type) {</span>
<span class="source-line-no">088</span><span id="line-88">                                E endpoint = ProcessorFactory.this.createEndpoint(connection, handler, type);</span>
<span class="source-line-no">089</span><span id="line-89">                                if (endpoint != null) {</span>
<span class="source-line-no">090</span><span id="line-90">                                        return endpoint;</span>
<span class="source-line-no">091</span><span id="line-91">                                }</span>
<span class="source-line-no">092</span><span id="line-92">                                return other.createEndpoint(connection, handler, type);</span>
<span class="source-line-no">093</span><span id="line-93">                        }</span>
<span class="source-line-no">094</span><span id="line-94">                        </span>
<span class="source-line-no">095</span><span id="line-95">                        @Override</span>
<span class="source-line-no">096</span><span id="line-96">                        public ProcessorInfo&lt;P&gt; createProcessor(ProcessorConfig&lt;P&gt; config, ProgressMonitor progressMonitor) {                           </span>
<span class="source-line-no">097</span><span id="line-97">                                // TODO - split monitor?</span>
<span class="source-line-no">098</span><span id="line-98">                                ProcessorInfo&lt;P&gt; info = ProcessorFactory.this.createProcessor(config, progressMonitor);</span>
<span class="source-line-no">099</span><span id="line-99">                                return info.getProcessor() == null ? other.createProcessor(config, progressMonitor) : info;</span>
<span class="source-line-no">100</span><span id="line-100">                        }</span>
<span class="source-line-no">101</span><span id="line-101">                };</span>
<span class="source-line-no">102</span><span id="line-102">                </span>
<span class="source-line-no">103</span><span id="line-103">        }</span>
<span class="source-line-no">104</span><span id="line-104">        </span>
<span class="source-line-no">105</span><span id="line-105">        /**</span>
<span class="source-line-no">106</span><span id="line-106">         * Composes a stream of factories into a single factory.</span>
<span class="source-line-no">107</span><span id="line-107">         * @param &lt;P&gt;</span>
<span class="source-line-no">108</span><span id="line-108">         * @param &lt;H&gt;</span>
<span class="source-line-no">109</span><span id="line-109">         * @param &lt;E&gt;</span>
<span class="source-line-no">110</span><span id="line-110">         * @param factories</span>
<span class="source-line-no">111</span><span id="line-111">         * @return</span>
<span class="source-line-no">112</span><span id="line-112">         */</span>
<span class="source-line-no">113</span><span id="line-113">        static &lt;P, H, E&gt; Optional&lt;ProcessorFactory&lt;P, H, E&gt;&gt; compose(Stream&lt;ProcessorFactory&lt;P, H, E&gt;&gt; factories) {</span>
<span class="source-line-no">114</span><span id="line-114">                return factories.reduce(Composeable::composer);</span>
<span class="source-line-no">115</span><span id="line-115">        }</span>
<span class="source-line-no">116</span><span id="line-116"></span>
<span class="source-line-no">117</span><span id="line-117">}</span>




























































</pre>
</div>
</main>
</body>
</html>
