<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FileSystemContainer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Nasdanika Resources</a> &gt; <a href="index.source.html" class="el_package">org.nasdanika.resources</a> &gt; <span class="el_source">FileSystemContainer.java</span></div><h1>FileSystemContainer.java</h1><pre class="source lang-java linenums">package org.nasdanika.resources;

import java.util.Collections;
import java.util.HashMap;
import java.util.Map;

import org.nasdanika.common.ProgressMonitor;

/**
 * Wrapper for a file system directory.
 * @author Pavel
 *
 */
public class FileSystemContainer extends FileSystemResource implements BinaryEntityContainer {

	public FileSystemContainer(java.io.File file) {
<span class="nc" id="L17">		super(file);</span>
<span class="nc" id="L18">	}</span>

	protected FileSystemResource getChild(String name, ProgressMonitor monitor) {
<span class="nc" id="L21">		return (FileSystemResource) getChildren(monitor).get(name);</span>
	}

	@Override
	public FileSystemResource find(String path, ProgressMonitor monitor) {
<span class="nc" id="L26">		int sPos = path.indexOf(SEPARATOR);</span>
<span class="nc bnc" id="L27" title="All 2 branches missed.">		if (sPos == -1) {</span>
<span class="nc" id="L28">			return getChild(path, monitor); </span>
		}
<span class="nc" id="L30">		String firstSegment = path.substring(0, sPos);</span>
<span class="nc" id="L31">		FileSystemResource child = getChild(firstSegment, monitor.split(&quot;Getting child at &quot;+firstSegment, 1, this));</span>
<span class="nc bnc" id="L32" title="All 2 branches missed.">		if (child instanceof FileSystemContainer) {</span>
<span class="nc" id="L33">			String pathTail = path.substring(sPos+1);</span>
<span class="nc" id="L34">			return ((FileSystemContainer) child).find(pathTail, monitor.split(&quot;Finding &quot;+pathTail, 1, child));</span>
		}
<span class="nc" id="L36">		return null;</span>
	}

	@Override
	public FileSystemEntity get(String path, ProgressMonitor monitor) {
<span class="nc" id="L41">		FileSystemResource existing = find(path, monitor.split(&quot;Finding &quot;+path, 1, this));</span>
<span class="nc bnc" id="L42" title="All 2 branches missed.">		if (existing instanceof FileSystemEntity) {</span>
<span class="nc" id="L43">			return (FileSystemEntity) existing;</span>
		}
<span class="nc bnc" id="L45" title="All 2 branches missed.">		if (existing instanceof FileSystemContainer) {</span>
			// container - can't have an entity with the same name.
<span class="nc" id="L47">			return null;</span>
		}
<span class="nc" id="L49">		int sPos = path.indexOf(SEPARATOR);</span>
<span class="nc bnc" id="L50" title="All 2 branches missed.">		if (sPos == -1) {</span>
<span class="nc" id="L51">			return new FileSystemEntity(new java.io.File(file, path));</span>
		}
		
<span class="nc" id="L54">		String firstSegment = path.substring(0, sPos);</span>
<span class="nc" id="L55">		FileSystemContainer container = getContainer(firstSegment, monitor.split(&quot;Getting container &quot;+firstSegment, 1, this));</span>
<span class="nc" id="L56">		String pathTail = path.substring(sPos + 1);</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">		return container == null ? null : container.get(pathTail, monitor.split(&quot;Getting entity at &quot;+pathTail, 1, container));</span>
	}

	@Override
	public FileSystemContainer getContainer(String path, ProgressMonitor monitor) {
<span class="nc" id="L62">		FileSystemResource existing = find(path, monitor.split(&quot;Finding existing container&quot;, 1, this));</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">		if (existing instanceof FileSystemContainer) {</span>
<span class="nc" id="L64">			return (FileSystemContainer) existing;</span>
		}
<span class="nc bnc" id="L66" title="All 2 branches missed.">		if (existing instanceof FileSystemEntity) {</span>
			// entity - can't have a container with the same name.
<span class="nc" id="L68">			return null;</span>
		}
<span class="nc" id="L70">		int sPos = path.indexOf(SEPARATOR);</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">		if (sPos == -1) {</span>
<span class="nc" id="L72">			return new FileSystemContainer(new java.io.File(file, path));</span>
		}
		
<span class="nc" id="L75">		String pathHead = path.substring(0, sPos);</span>
<span class="nc" id="L76">		FileSystemContainer container = getContainer(pathHead, monitor.split(&quot;Getting child container &quot;+pathHead, 1, this));</span>
<span class="nc" id="L77">		String pathTail = path.substring(sPos + 1);</span>
<span class="nc bnc" id="L78" title="All 2 branches missed.">		return container == null ? null : container.getContainer(pathTail, monitor.split(&quot;Getting child container &quot;+pathHead, 1, container));</span>
	}

	/**
	 * Returned values are instances of {@link FileSystemResource}, so the return value can be cast to Map&amp;lt;String, FileSystemResource&amp;gt;
	 */
	@Override
	public Map&lt;String, Object&gt; getChildren(ProgressMonitor monitor) {
<span class="nc" id="L86">		Map&lt;String, FileSystemResource&gt; ret = new HashMap&lt;&gt;();		</span>
<span class="nc" id="L87">		java.io.File[] children = file.listFiles();</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">		if (children != null) {</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">			for (java.io.File child: children) {</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">				if (child.isFile()) {</span>
<span class="nc" id="L91">					ret.put(child.getName(), new FileSystemEntity(child));</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">				} else if (child.isDirectory()) {</span>
<span class="nc" id="L93">					ret.put(child.getName(), new FileSystemContainer(child));</span>
				}
			}
		}
<span class="nc" id="L97">		return Collections.unmodifiableMap(ret);</span>
	}

	@Override
	public void copy(Container&lt;? super BinaryEntity&gt; container, String path, ProgressMonitor monitor) {
<span class="nc" id="L102">		throw new UnsupportedOperationException(&quot;Implement when needed&quot;);		</span>
	}

	@Override
	public void move(Container&lt;? super BinaryEntity&gt; container, String path, ProgressMonitor monitor) {
<span class="nc" id="L107">		throw new UnsupportedOperationException(&quot;Implement when needed&quot;);		</span>
	}

	@Override
	public void put(String path, BinaryEntity element, ProgressMonitor monitor) throws IllegalArgumentException {
<span class="nc" id="L112">		throw new UnsupportedOperationException(&quot;Use get() and getContainer() to operate with file system resources&quot;);		</span>
	}

	@Override
	public void delete(ProgressMonitor monitor) {
<span class="nc bnc" id="L117" title="All 2 branches missed.">		for (Object child: getChildren(monitor.split(&quot;Getting children&quot;, 1, this)).values()) {</span>
<span class="nc" id="L118">			((FileSystemResource) child).delete(monitor.split(&quot;Deleting child&quot;, 1, child));</span>
<span class="nc" id="L119">		}</span>
<span class="nc" id="L120">		super.delete(monitor);</span>
<span class="nc" id="L121">	}</span>

	@Override
	public Object delete(String path, ProgressMonitor monitor) {
<span class="nc" id="L125">		FileSystemResource toDelete = get(path, monitor.split(&quot;Getting resource to delete: &quot;+path, 1, this));</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">		if (toDelete != null) {</span>
<span class="nc" id="L127">			toDelete.delete(monitor.split(&quot;Deleting &quot;+path, 1, toDelete));</span>
		}
<span class="nc" id="L129">		return toDelete;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>