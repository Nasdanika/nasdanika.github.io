<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ListSupplierFactoryAdapter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Nasdanika HTML Model Generation Adapters</a> &gt; <a href="index.source.html" class="el_package">org.nasdanika.html.model.html.gen</a> &gt; <span class="el_source">ListSupplierFactoryAdapter.java</span></div><h1>ListSupplierFactoryAdapter.java</h1><pre class="source lang-java linenums">package org.nasdanika.html.model.html.gen;

import java.io.InputStream;
import java.util.Map;

import org.eclipse.emf.common.notify.impl.AdapterImpl;
import org.eclipse.emf.ecore.EObject;
import org.json.JSONArray;
import org.json.JSONObject;
import org.nasdanika.common.Context;
import org.nasdanika.common.Function;
import org.nasdanika.common.ListCompoundSupplierFactory;
import org.nasdanika.common.MapCompoundSupplierFactory;
import org.nasdanika.common.Supplier;
import org.nasdanika.common.SupplierFactory;
import org.nasdanika.common.Util;
import org.nasdanika.emf.EObjectAdaptable;
import org.nasdanika.html.Tag;
import org.nasdanika.ncore.EObjectProperty;
import org.nasdanika.ncore.Property;

public class ListSupplierFactoryAdapter extends AdapterImpl implements SupplierFactory&lt;InputStream&gt; {
	
<span class="nc" id="L24">	protected ListSupplierFactoryAdapter(org.nasdanika.ncore.List list) {</span>
<span class="nc" id="L25">		setTarget(list);</span>
<span class="nc" id="L26">	}</span>

	@Override
	public Supplier&lt;InputStream&gt; create(Context ctx) {
<span class="nc" id="L30">		SupplierFactory&lt;JSONArray&gt; jsf = createJsonArraySupplierFactory((org.nasdanika.ncore.List) getTarget());</span>
<span class="nc" id="L31">		Function&lt;Object, String&gt; toStringFunction = Function.fromFunction(Object::toString, &quot;toString()&quot;, 1);</span>
<span class="nc" id="L32">		return jsf.create(ctx).then(toStringFunction).then(Util.TO_STREAM.create(ctx));</span>
	}
	
	/**
	 * Creates {@link SupplierFactory} of {@link JSONArray} from a list.
	 * The factory is aware of model classes in Ncore package. Model elements
	 * of unknown classes are adapted to SupplierFactory.  
	 * @return
	 */
	public static SupplierFactory&lt;JSONArray&gt; createJsonArraySupplierFactory(org.nasdanika.ncore.List list) {
<span class="nc" id="L42">		ListCompoundSupplierFactory&lt;Object&gt; elementsFactory = new ListCompoundSupplierFactory&lt;&gt;(&quot;Elements&quot;);</span>
<span class="nc bnc" id="L43" title="All 2 branches missed.">		for (EObject element: list.getValue()) {</span>
<span class="nc bnc" id="L44" title="All 2 branches missed.">			if (element instanceof org.nasdanika.ncore.List) {</span>
<span class="nc" id="L45">				elementsFactory.add(createJsonArraySupplierFactory((org.nasdanika.ncore.List) element));				</span>
<span class="nc bnc" id="L46" title="All 2 branches missed.">			} else if (element instanceof org.nasdanika.ncore.Map) {</span>
<span class="nc" id="L47">				elementsFactory.add(createJsonObjectSupplierFactory((org.nasdanika.ncore.Map) element));</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">			} else if (element instanceof org.nasdanika.ncore.Boolean) {</span>
<span class="nc" id="L49">				elementsFactory.add(SupplierFactory.from(((org.nasdanika.ncore.Boolean) element).isValue(), &quot;Boolean&quot;));</span>
<span class="nc bnc" id="L50" title="All 2 branches missed.">			} else if (element instanceof org.nasdanika.ncore.Integer) {</span>
<span class="nc" id="L51">				elementsFactory.add(SupplierFactory.from(((org.nasdanika.ncore.Integer) element).getValue(), &quot;Integer&quot;));</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">			} else if (element instanceof org.nasdanika.ncore.String) {</span>
<span class="nc" id="L53">				elementsFactory.add(SupplierFactory.from(((org.nasdanika.ncore.String) element).getValue(), &quot;String&quot;));</span>
			} else {
<span class="nc" id="L55">				elementsFactory.add(adaptToSupplierFactory(element));</span>
			}
<span class="nc" id="L57">		}</span>

<span class="nc" id="L59">		return elementsFactory.then(ListSupplierFactoryAdapter::createListToJsonArrayFunction);</span>
	}
	
	/**
	 * Attempts to adapt to {@link Tag} factory first using {@link SupplierFactory.Provider}. Then to InputStream factory and chains with toString factory. 
	 * @param obj
	 * @return
	 */
	private static SupplierFactory&lt;? extends Object&gt; adaptToSupplierFactory(EObject obj) {
<span class="nc" id="L68">		Provider provider = EObjectAdaptable.adaptTo(obj, Provider.class);</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">		if (provider != null) {</span>
<span class="nc" id="L70">			SupplierFactory&lt;Tag&gt; tagFactory = provider.getFactory(Tag.class);</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">			if (tagFactory != null) {</span>
<span class="nc" id="L72">				return tagFactory;</span>
			}
			
<span class="nc" id="L75">			SupplierFactory&lt;InputStream&gt; streamFactory = provider.getFactory(InputStream.class);</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">			if (streamFactory != null) {</span>
<span class="nc" id="L77">				return streamFactory.then(Util.TO_STRING);</span>
			}
		}
		
		
<span class="nc" id="L82">		return EObjectAdaptable.adaptToSupplierFactoryNonNull(obj, Object.class).then(Util.OBJECT_TO_STRING_FACTORY);</span>
	}

	private static Function&lt;java.util.List&lt;Object&gt;, JSONArray&gt; createListToJsonArrayFunction(Context context) {
<span class="nc" id="L86">		return Function.fromFunction(JSONArray::new, &quot;List to JSON array&quot;, 1);</span>
	}

	private static Function&lt;java.util.Map&lt;String, Object&gt;, JSONObject&gt; createMapToJsonObjectFunction(Context context) {
<span class="nc" id="L90">		java.util.function.Function&lt;Map&lt;String, Object&gt;, JSONObject&gt; func = map -&gt; {</span>
<span class="nc" id="L91">			return new JSONObject(map);</span>
		};
<span class="nc" id="L93">		return Function.fromFunction(func, &quot;Map to JSON Object&quot;, 1);</span>
	}

	/**
	 * Creates {@link SupplierFactory} of {@link JSONObject} from a map.
	 * The factory is aware of model classes in Ncore package. Model elements
	 * of unknown classes are adapted to SupplierFactory.  
	 * @return
	 */
	public static SupplierFactory&lt;JSONObject&gt; createJsonObjectSupplierFactory(org.nasdanika.ncore.Map map) {
<span class="nc" id="L103">		MapCompoundSupplierFactory&lt;String,Object&gt; entryFactory = new MapCompoundSupplierFactory&lt;&gt;(&quot;Entries&quot;);</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">		for (Property element: map.getValue()) {</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">			if (element instanceof org.nasdanika.ncore.ListProperty) {</span>
<span class="nc" id="L106">				entryFactory.put(element.getName(), createJsonArraySupplierFactory((org.nasdanika.ncore.List) element));				</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">			} else if (element instanceof org.nasdanika.ncore.MapProperty) {</span>
<span class="nc" id="L108">				entryFactory.put(element.getName(),createJsonObjectSupplierFactory((org.nasdanika.ncore.Map) element));</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">			} else if (element instanceof org.nasdanika.ncore.BooleanProperty) {</span>
<span class="nc" id="L110">				entryFactory.put(element.getName(), SupplierFactory.from(((org.nasdanika.ncore.Boolean) element).isValue(), &quot;Boolean&quot;));</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">			} else if (element instanceof org.nasdanika.ncore.IntegerProperty) {</span>
<span class="nc" id="L112">				entryFactory.put(element.getName(), SupplierFactory.from(((org.nasdanika.ncore.Integer) element).getValue(), &quot;Integer&quot;));</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">			} else if (element instanceof org.nasdanika.ncore.StringProperty) {</span>
<span class="nc" id="L114">				entryFactory.put(element.getName(), SupplierFactory.from(((org.nasdanika.ncore.String) element).getValue(), &quot;String&quot;));</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">			} else if (element instanceof EObjectProperty) {</span>
<span class="nc" id="L116">				entryFactory.put(element.getName(), adaptToSupplierFactory(((EObjectProperty) element).getValue()));</span>
			} else {
<span class="nc" id="L118">				throw new UnsupportedOperationException(&quot;Unsupported property type: &quot; + element);</span>
			}
<span class="nc" id="L120">		}</span>

<span class="nc" id="L122">		return entryFactory.then(ListSupplierFactoryAdapter::createMapToJsonObjectFunction);</span>
	}
//
//	/**
//	 * Creates {@link SupplierFactory} of {@link BiSupplier} from a property.
//	 * The factory is aware of model classes in Ncore package. Model elements
//	 * of unknown classes are adapted to SupplierFactory assuming that the result is InputStream.  
//	 * @return
//	 */
//	public static SupplierFactory&lt;BiSupplier&lt;String, Object&gt;&gt; createPropertySupplierFactory(org.nasdanika.ncore.Property property) {
//		throw new UnsupportedOperationException();
//	}

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>